---
const scenes = [
  {
    title: "semantic search",
    command: 'grepai search "user authentication flow"',
    output: `<span class="text-terminal-green">Found 5 results</span> (0.12s)

<span class="text-terminal-purple">auth/handler.go</span>:<span class="text-terminal-yellow">42</span> <span class="text-terminal-green">(0.89)</span>
<span class="text-gray-400">  func (h *Handler) Login(ctx context.Context, creds Credentials) (*Token, error)</span>

<span class="text-terminal-purple">middleware/jwt.go</span>:<span class="text-terminal-yellow">18</span> <span class="text-terminal-green">(0.85)</span>
<span class="text-gray-400">  func ValidateToken(token string) (*Claims, error)</span>

<span class="text-terminal-purple">services/user.go</span>:<span class="text-terminal-yellow">127</span> <span class="text-terminal-green">(0.82)</span>
<span class="text-gray-400">  func (s *Service) Authenticate(email, password string) (*User, error)</span>`
  },
  {
    title: "JSON output",
    command: 'grepai search "error handling" --json',
    output: `<span class="text-gray-400">[
  {
    <span class="text-terminal-blue">"file"</span>: <span class="text-terminal-green">"pkg/errors/handler.go"</span>,
    <span class="text-terminal-blue">"line"</span>: <span class="text-terminal-yellow">23</span>,
    <span class="text-terminal-blue">"score"</span>: <span class="text-terminal-yellow">0.91</span>,
    <span class="text-terminal-blue">"preview"</span>: <span class="text-terminal-green">"func HandleError(err error) Response"</span>
  },
  {
    <span class="text-terminal-blue">"file"</span>: <span class="text-terminal-green">"internal/api/middleware.go"</span>,
    <span class="text-terminal-blue">"line"</span>: <span class="text-terminal-yellow">45</span>,
    <span class="text-terminal-blue">"score"</span>: <span class="text-terminal-yellow">0.87</span>
  }
]</span>`
  },
  {
    title: "trace callers",
    command: 'grepai trace callers "HandleRequest"',
    output: `<span class="text-terminal-green">Found 4 callers</span> of HandleRequest

<span class="text-terminal-purple">main.go</span>:<span class="text-terminal-yellow">52</span>
<span class="text-gray-400">  └─ main()</span>

<span class="text-terminal-purple">server/router.go</span>:<span class="text-terminal-yellow">78</span>
<span class="text-gray-400">  └─ SetupRoutes()</span>

<span class="text-terminal-purple">server/router.go</span>:<span class="text-terminal-yellow">112</span>
<span class="text-gray-400">  └─ RegisterHandler()</span>

<span class="text-terminal-purple">tests/handler_test.go</span>:<span class="text-terminal-yellow">34</span>
<span class="text-gray-400">  └─ TestHandleRequest()</span>`
  },
  {
    title: "trace callees",
    command: 'grepai trace callees "ProcessOrder"',
    output: `<span class="text-terminal-green">ProcessOrder</span> calls 3 functions

<span class="text-terminal-purple">→</span> <span class="text-terminal-purple">ValidateOrder</span> <span class="text-gray-400">orders/validation.go:15</span>
<span class="text-terminal-purple">→</span> <span class="text-terminal-purple">CalculateTotal</span> <span class="text-gray-400">orders/pricing.go:42</span>
<span class="text-terminal-purple">→</span> <span class="text-terminal-purple">SaveToDatabase</span> <span class="text-gray-400">orders/repository.go:28</span>`
  },
  {
    title: "watch mode",
    command: 'grepai watch',
    output: `<span class="text-terminal-green">✓</span> Indexed <span class="text-terminal-yellow">1,247</span> files in 3.2s
<span class="text-terminal-green">✓</span> Watching for changes...

<span class="text-terminal-blue">[15:42:01]</span> Changed: src/api/handler.go
<span class="text-terminal-green">✓</span> Re-indexed 1 file (0.1s)

<span class="text-terminal-blue">[15:42:15]</span> Added: src/api/middleware.go
<span class="text-terminal-green">✓</span> Indexed 1 new file (0.1s)`
  },
  {
    title: "agent setup",
    command: 'grepai agent-setup cursor',
    output: `<span class="text-terminal-green">✓</span> Detected: Cursor IDE

<span class="text-terminal-yellow">→</span> Adding grepai to .cursor/rules...
<span class="text-terminal-green">✓</span> Configuration added

<span class="text-terminal-yellow">→</span> Verifying installation...
<span class="text-terminal-green">✓</span> grepai is ready to use with Cursor!

<span class="text-gray-400">Your AI agent can now use:</span>
  <span class="text-terminal-purple">•</span> grepai search "query"
  <span class="text-terminal-purple">•</span> grepai trace callers "symbol"
  <span class="text-terminal-purple">•</span> grepai trace callees "symbol"`
  }
];
---

<div class="terminal-demo max-w-3xl mx-auto mb-16 rounded-xl overflow-hidden shadow-2xl animate-slide-up">
  <!-- Terminal header -->
  <div class="bg-terminal-header px-4 py-3 flex items-center gap-3">
    <div class="flex gap-2">
      <span class="w-3 h-3 rounded-full bg-terminal-red"></span>
      <span class="w-3 h-3 rounded-full bg-terminal-yellow"></span>
      <span class="w-3 h-3 rounded-full bg-terminal-green"></span>
    </div>
    <span class="flex-1 text-center text-sm text-gray-500 font-mono" id="terminal-title">
      grepai — {scenes[0].title}
    </span>
  </div>

  <!-- Terminal body -->
  <div class="bg-terminal-bg p-6 font-mono text-sm md:text-base h-[400px] md:h-[450px] overflow-hidden">
    <div class="terminal-content">
      <div class="terminal-line">
        <span class="text-terminal-green">$</span>
        <span class="text-terminal-blue ml-2" id="terminal-command"></span>
        <span class="inline-block w-2 h-5 bg-terminal-green align-middle ml-0.5 animate-blink" id="typing-cursor"></span>
      </div>
      <div class="terminal-output mt-4 whitespace-pre-wrap leading-relaxed" id="terminal-output"></div>
    </div>
  </div>
</div>

<script define:vars={{ scenes }}>
  const TYPING_SPEED = 40;
  const OUTPUT_DELAY = 300;
  const SCENE_DURATION = 5000;

  let currentScene = 0;
  let isTyping = false;

  const titleEl = document.getElementById('terminal-title');
  const commandEl = document.getElementById('terminal-command');
  const outputEl = document.getElementById('terminal-output');
  const cursorEl = document.getElementById('typing-cursor');

  async function typeText(element, text) {
    isTyping = true;
    element.textContent = '';
    for (let i = 0; i < text.length; i++) {
      element.textContent += text[i];
      await new Promise(r => setTimeout(r, TYPING_SPEED));
    }
    isTyping = false;
  }

  async function showOutput(html) {
    outputEl.style.opacity = '0';
    outputEl.innerHTML = html;
    await new Promise(r => setTimeout(r, 50));
    outputEl.style.opacity = '1';
    outputEl.style.transition = 'opacity 0.3s ease';
  }

  async function playScene(index) {
    const scene = scenes[index];

    // Update title
    titleEl.textContent = `grepai — ${scene.title}`;

    // Clear previous
    commandEl.textContent = '';
    outputEl.innerHTML = '';
    outputEl.style.opacity = '1';
    cursorEl.style.display = 'inline-block';

    // Type command
    await typeText(commandEl, scene.command);

    // Hide cursor, show output
    cursorEl.style.display = 'none';
    await new Promise(r => setTimeout(r, OUTPUT_DELAY));
    await showOutput(scene.output);

    // Wait then next scene
    await new Promise(r => setTimeout(r, SCENE_DURATION));

    // Next scene
    currentScene = (currentScene + 1) % scenes.length;
    playScene(currentScene);
  }

  // Start animation
  playScene(0);
</script>
